<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ticketing System Dashboard</title>
    <!-- Link to your CSS file -->
    <link rel="stylesheet" href="style.css">
</head>
<body>
<header>
    <!-- User's name and logout button -->
    <div class="brand">
        [LOGO HERE]
    </div>
    <div class="user-info">
        <span id="user-name">User Name</span>
        <button id="logout-btn">Logout</button>
    </div>
</header>
<main>
    <!-- Search bar, sort by option, and create new ticket button -->
    <div class="dashboard-controls">
        <input type="text" id="search-bar" placeholder="Search...">
        <select id="sort-by">
            <option value="date">Sort by Date</option>
            <option value="status">Sort by Status</option>
        </select>
        <button id="create-ticket-btn" onclick="openForm()">Create New Ticket</button>
    </div>
    <div class="ticketPopup">
        <div class="formPopup" id="popupForm">
            <h2>Create New Ticket</h2>
            <button id="close-ticket-create-btn" onclick="closeForm()">X</button>
            <form id="ticket-form">
                <label for="client-name">Client Name:</label>
                <input type="text" id="client-name" required><br>
                <label for="order-number">Order Number:</label>
                <input type="text" id="order-number" required><br>
                <label for="priority-level">Priority Level:</label>
                <select id="priority-level" required>
                    <option value="low">Low</option>
                    <option value="medium">Medium</option>
                    <option value="high">High</option>
                </select><br>
                <label for="capacity-utilization">Capacity Utilization:</label>
                <input type="number" id="capacity-utilization" required><br>
                <label for="status">Status:</label>
                <select id="status" required>
                    <option value="PENDING">PENDING</option>
                    <option value="ACCEPTED">ACCEPTED</option>
                    <option value="IN PROGRESS">IN PROGRESS</option>
                    <option value="ON THE WAY">ON THE WAY</option>
                    <option value="COMPLETED">COMPLETED</option>
                </select><br>
                <label for="handler">Agent/Employee Handling:</label>
                <input type="text" id="handler" required><br>
                <button type="submit">Create Ticket</button>
            </form>
        </div>
    </div>
    <!-- Ticket entries -->
    <div class="ticket-entries">
        <!-- Each ticket entry
        <div class="ticket-entry">
            <div class="ticket-info">
                <div class="left-info">
                    <p>Request for: [Requester Name]</p>
                    <p>Created on: [Creation Date]</p>
                    <p>Handled by: [Handler Name]</p>
                </div>
                <div class="right-info">
                    <p>Status: [Ticket Status]</p>
                </div>
            </div>
        </div>
        -->
    </div>
</main>
<script>
    function openForm() {
        document.getElementById("popupForm").style.display = "block";
    }

    function closeForm() {
        document.getElementById("popupForm").style.display = "none";
    }

    document.addEventListener("DOMContentLoaded", async function() {
        const user = window.location.pathname.split('/').pop();
        const response = await fetch(`/tickets/${user}`);
        const tickets = await response.json();

        const ticketEntries = document.querySelector(".ticket-entries");

        tickets.forEach(ticket => {
            const ticketEntry = document.createElement("div");
            ticketEntry.classList.add("ticket-entry");
            ticketEntry.innerHTML = `
            <div class="ticket-info">
                <div class="left-info">
                    <p>Request for: ${ticket.clientName}</p>
                    <p>Created on: ${new Date(ticket.creationDate).toLocaleDateString()}</p>
                    <p>Handled by: ${ticket.handler}</p> <!-- Adjust based on how you store handler -->
                </div>
                <div class="right-info">
                    <p>Status: ${ticket.orderStatus}</p>
                </div>
            </div>
        `;
            ticketEntries.appendChild(ticketEntry);
        });
    });
</script>
</body>
</html>